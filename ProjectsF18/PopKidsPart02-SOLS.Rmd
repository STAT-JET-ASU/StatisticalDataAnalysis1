---
title: "Popularity Study, Part 2"
author: "SOLUTIONS"
date: 'Updated: `r format(Sys.time(), "%A, %B %d, %Y @ %X")`'
output: 
  html_document: 
    highlight: textmate
    theme: cosmo
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(comment = "")
knitr::opts_chunk$set(message = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```

```{r, echo=FALSE}
# load all packages and datasets here
library(tidyverse)
popkids <- read.csv("https://raw.githubusercontent.com/STAT-JET-ASU/Datasets/master/Instructor/popular.csv")
```

<hr>

For all tests, write the null and alternative hypotheses, report the test statistic and the p-value, state whether or not you reject the null hypothesis, and then give your conclusion in terms of the original question.

1) Researchers chose their sample with the goal of having about 1/3 of  students come from each school district type. Were they successful? Perform a goodness of fit test. If they weren't successful, which districts have too many or two few students selected?

Ho: $\pi_{rural} = \pi_{suburban} = \pi_{urban} = \frac{1}{3}$

Ha: At least one proportion is not one-third.

Traditional Test:
```{r}
chisq.test(table(popkids$district_type))
```

Conclusions: We fail to reject Ho at the &alpha; = 0.05 level and conclude that the researchers were successful in getting about one-third of their sample from each district type.


2) Perform a permutation hypothesis test to determine whether there is there a statistically significant relationship between gender and top goal. If so, what is the nature of the relationship?

Ho: Gender and top goal are independent.

Ha: Gender and top goal are not independent.

Permutation Test:
```{r}
chisq.teststat <- function(Obs){ 
  Exp <- outer(rowSums(Obs),colSums(Obs))/sum(Obs)
  sum((Obs-Exp)^2/Exp)
}

teststat <- chisq.teststat(table(popkids$gender, popkids$top_goal))
gender   <- popkids$gender
goal     <- popkids$top_goal

N <- 10^4-1
randomdiff<-numeric(N)

for (i in 1:N){
  GOALperm <-sample(goal)
  RANDOMtable <- table(gender, GOALperm)
  randomdiff[i]<-chisq.teststat(RANDOMtable)
}

pvalue <- (sum(randomdiff >= teststat) + 1)/(N + 1)

print(teststat)
print(pvalue)

prop.table(table(popkids$gender, popkids$top_goal), 1)
```

Conclusions: We reject Ho at the &alpha; = 0.05 level and conclude that gender and top goal are related. About 52% of both boys and girls chose grades as their top goal. However, for those who did not, boys were somewhat more likely to choose sports than popularity, while girls were three times more likely to choose popularity than sports.


3) Given the sampling strategy the researchers used in this study, we could consider each type of school district to be a separate population. Perform a traditional hypothesis test to determine whether the distribution of top goal is the same in all three types of school district. If not, in what ways do the district types differ?

Ho: The distribution of goals is the same for each district type.

Ha: At least one of the distributions is not the same.

Traditional Test:
```{r}
chisq.test(table(popkids$district_type, popkids$top_goal))

# Not required, but for comparison...

teststat <- chisq.teststat(table(popkids$district_type, popkids$top_goal))
district <- popkids$district_type
goal     <- popkids$top_goal

N <- 10^4-1
randomdiff<-numeric(N)

for (i in 1:N){
  GOALperm <-sample(goal)
  RANDOMtable <- table(district, GOALperm)
  randomdiff[i]<-chisq.teststat(RANDOMtable)
}

pvalue <- (sum(randomdiff >= teststat) + 1)/(N + 1)

print(teststat)
print(pvalue)

prop.table(table(popkids$district_type, popkids$top_goal), 1)
```

Conclusions: We reject Ho at the &alpha; = 0.05 level and conclude that at least one distribution is different. The suburban and urban groups had virtualy identical proportions, with grades being the top choice, followed by popularity and then sports. The rural group had fewer students who chose grades and more students who chose popularity and sports; the proportion choosing sports was actualy double that in the other two districts.


4) A chi-square test shows that the three types of school districts do not have the same proportions of boys and girls (p = 0.0024). How might this affect your tests and conclusions in (2) and (3)?

ANSWER: We found that gender and goal are dependent on one another, so if there are different numbers of boys and girls in the school district samples, perhaps the finding for the school districts is really related to the gender differences, not the districts themselves. Conversely, it could also be true that the relationship we found for boys and girls is really related to the type of district. Perhaps separate analyses are needed for the different types of districts.

<hr>

END PART 2

